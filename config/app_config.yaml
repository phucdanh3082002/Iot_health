# IoT Health Monitoring System Configuration

# Application Settings
app:
  name: "IoT Health Monitor"
  version: "1.0.0"
  debug: true
  log_level: "INFO"

# Patient Configuration
patient:
  id: "patient_001"
  name: "Default Patient"
  age: 65
  gender: "M"

# Sensor Configuration
sensors:
  max30102:
    enabled: true
    sample_rate: 5  # Hz - polling frequency (đọc mỗi 0.2s)
    hardware_sample_rate: 50  # Hz - MAX30102 internal sampling
    max_samples_per_read: 16  # Đọc 16 samples/lần (~0.32s @ 50Hz raw)
    led_mode: 3  # SpO2 mode (RED and IR LEDs active)
    pulse_amplitude_red: 0x7F  # High brightness for LED visibility
    pulse_amplitude_ir: 0x7F   # High brightness for LED visibility
    adc_range: 4096
    sample_average: 4  # OPTIMIZED: Cân bằng SNR và throughput (4 samples average)
    buffer_size: 100  # buffer size for calculations
    ir_threshold: 50000  # threshold for finger detection
    min_readings_for_calc: 50  # minimum readings before calculating HR/SpO2
    
  mlx90614:
    enabled: true
    sensor_type: "MLX90614"  # GY-906 infrared temperature sensor
    i2c_bus: 1
    i2c_address: 0x5A
    sample_rate: 0.5  # Hz - slower rate for stability
    use_object_temp: true  # true for body temperature, false for ambient
    temperature_offset: 0.0  # calibration offset
    smooth_factor: 0.1  # smoothing filter factor
    max_error_count: 5  # reduce from default 10
    
  blood_pressure:
    enabled: true
    pressure_sensor: "HX710B"
    pump_gpio: 26  # Updated: GPIO26 for pump control via 4N35
    valve_gpio: 16  # Updated: GPIO16 for valve control via 4N35
    inflate_target_mmhg: 165
    max_pressure: 180  # mmHg
    safety_pressure: 200  # mmHg
    deflate_rate_mmhg_s: 3.0
    ratio:
      sys_frac: 0.5
      dia_frac: 0.8

  hx710b:
    enabled: true  # Updated: Enable HX710B sensor
    gpio_dout: 6   # Updated: GPIO6 for HX710B data output
    gpio_sck: 5    # Updated: GPIO5 for HX710B clock
    sps_hint: 50
    calibration:
      offset_counts: 0
      slope_mmhg_per_count: 0.001
    timeout_ms: 1000

# Display Configuration
display:
  type: "SPI_LCD"
  size: "3.5"
  resolution: [480, 320]
  framebuffer: "/dev/fb1"
  rotation: 0

# Alert Thresholds
thresholds:
  heart_rate:
    min: 60
    max: 100
    critical_min: 40
    critical_max: 150
    
  spo2:
    min: 95
    critical_min: 90
    
  temperature:
    min: 36.0
    max: 37.5
    critical_min: 35.0
    critical_max: 39.0
    
  blood_pressure:
    systolic_max: 140
    diastolic_max: 90
    systolic_critical: 180
    diastolic_critical: 110

# Communication Settings
communication:
  mqtt:
    broker_host: "localhost"
    broker_port: 1883
    username: ""
    password: ""
    use_tls: false
    topic_prefix: "health"
    qos: 1
    
  rest_api:
    server_url: "http://localhost:8000"
    api_version: "v1"
    timeout: 5
    use_https: false
    
  store_forward:
    enabled: true
    max_queue_size: 1000
    retry_interval: 30  # seconds
    max_retries: 5

# Audio Settings
audio:
  enabled: true
  volume: 80
  alert_sound: "config/alert.wav"
  voice_enabled: true
  tts_engine: "piper"
  fallback_engine: "espeak"
  locale: "vi"
  piper:
    model_path: "/home/pi/piper_models/vi_VN-vais1000-medium.onnx"
    config_path: "/home/pi/piper_models/vi_VN-vais1000-medium.onnx.json"
    speaker: ""
    assets_dir: "asset/tts"
    strict_assets: true

# Logging Configuration
logging:
  level: "INFO"
  file: "logs/health_monitor.log"
  max_size: "10MB"
  backup_count: 5
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Database Configuration
database:
  type: "sqlite"
  path: "data/health_monitor.db"
  backup_enabled: true
  backup_interval: 3600  # seconds

# AI/ML Configuration
ai:
  anomaly_detection:
    enabled: true
    algorithm: "IsolationForest"
    sensitivity: 0.1
    
  trend_analysis:
    enabled: true
    window_size: 24  # hours
    
  chatbot:
    enabled: false
    model_path: "models/health_chatbot.tflite"