ai:
  anomaly_detection:
    algorithm: IsolationForest
    enabled: true
    sensitivity: 0.1
  chatbot:
    enabled: false
    model_path: models/health_chatbot.tflite
  trend_analysis:
    enabled: true
    window_size: 24
app:
  debug: true
  log_level: INFO
  name: IoT Health Monitor
  version: 1.0.0
audio:
  alert_sound: config/alert.wav
  enabled: true
  fallback_engine: espeak
  locale: vi
  piper:
    assets_dir: asset/tts
    config_path: /home/pi/piper_models/vi_VN-vais1000-medium.onnx.json
    model_path: /home/pi/piper_models/vi_VN-vais1000-medium.onnx
    speaker: ''
    strict_assets: true
  tts_engine: piper
  voice_enabled: true
  volume: 80
communication:
  mqtt:
    broker_host: localhost
    broker_port: 1883
    password: ''
    qos: 1
    topic_prefix: health
    use_tls: false
    username: ''
  rest_api:
    api_version: v1
    server_url: http://localhost:8000
    timeout: 5
    use_https: false
  store_forward:
    enabled: true
    max_queue_size: 1000
    max_retries: 5
    retry_interval: 30
database:
  backup_enabled: true
  backup_interval: 3600
  path: data/health_monitor.db
  type: sqlite
display:
  framebuffer: /dev/fb1
  resolution:
  - 480
  - 320
  rotation: 0
  size: '3.5'
  type: SPI_LCD
logging:
  backup_count: 5
  file: logs/health_monitor.log
  format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
  level: INFO
  max_size: 10MB
patient:
  age: 65
  gender: M
  id: patient_001
  name: Default Patient
sensors:
  blood_pressure:
    enabled: true
    inflate_target_mmhg: 165
    deflate_rate_mmhg_s: 3.0
    max_pressure_mmhg: 200
    pump_gpio: 26
    valve_gpio: 16
    # HX710B ADC configuration (nested)
    hx710b:
      enabled: true
      gpio_dout: 6
      gpio_sck: 5
      mode: '10sps'
      read_timeout_ms: 500
      calibration:
        offset_counts: 1287983
        slope_mmhg_per_count: 9.536743e-06
        adc_inverted: false
    # Signal processing algorithm configuration
    algorithm:
      sample_rate: 10.0          # Hz (HX710B SPS)
      bandpass_low: 0.5          # Hz (pulse frequency low cutoff)
      bandpass_high: 5.0         # Hz (pulse frequency high cutoff)
      filter_order: 4            # Butterworth filter order
      sys_ratio: 0.55            # SYS at 55% of max envelope amplitude
      dia_ratio: 0.80            # DIA at 80% of max envelope amplitude
  max30102:
    adc_range: 4096
    buffer_size: 100
    enabled: true
    hardware_sample_rate: 50
    ir_threshold: 50000
    led_mode: 3
    max_samples_per_read: 16
    min_readings_for_calc: 50
    pulse_amplitude_ir: 127
    pulse_amplitude_red: 127
    sample_average: 4
    sample_rate: 5
  mlx90614:
    enabled: true
    i2c_address: 90
    i2c_bus: 1
    max_error_count: 5
    sample_rate: 0.5
    sensor_type: MLX90614
    smooth_factor: 0.1
    temperature_offset: 0.0
    use_object_temp: true
thresholds:
  blood_pressure:
    diastolic_critical: 110
    diastolic_max: 90
    systolic_critical: 180
    systolic_max: 140
  heart_rate:
    critical_max: 150
    critical_min: 40
    max: 100
    min: 60
  spo2:
    critical_min: 90
    min: 95
  temperature:
    critical_max: 39.0
    critical_min: 35.0
    max: 37.5
    min: 36.0

# ==================== ADVANCED BP CONFIG (OPTIONAL) ====================
# Section này chứa config nâng cao cho đo huyết áp (PWM control, advanced signal processing)
# Hiện tại BloodPressureSensor sử dụng config đơn giản từ sensors.blood_pressure
# Có thể mở rộng sau để tích hợp PWM control và thuật toán xử lý tín hiệu nâng cao
bp_advanced:
  control:
    inflate_target_mmhg: 165.0
    inflate_soft_limit_mmhg: 200.0
    inflate_timeout_s: 25.0
    inflate_grace_s: 1.5
    deflate_target_dpdt_mmhg_s: 3.0
    deflate_pwm_period_s: 0.5
    deflate_lut:
    - bin: 160
      duty: 60
    - bin: 140
      duty: 55
    - bin: 120
      duty: 52
    - bin: 100
      duty: 48
    - bin: 80
      duty: 45
    - bin: 60
      duty: 42
    - bin: 40
      duty: 40
    deflate_timeout_s: 90.0
    emergency_overpressure_mmhg: 200.0
    emergency_no_oscillation_s: 10.0
    emergency_sensor_timeout_s: 2.0
    emergency_dpdt_too_fast_mmhg_s: 8.0
    leak_max_drop_mmhg_per_min: 5.0
  signal:
    bpf_low_hz: 0.5
    bpf_high_hz: 5.0
    detrend_poly_order: 1
    envelope_method: hilbert
    map_search_window:
    - 0.3
    - 0.8
    min_valid_peaks_around_map: 5
    snr_min_db: 6.0
    hampel_window_s: 1.2
    hampel_k: 3.0
    min_samples_per_bin: 20
  estimate:
    sys_frac: 0.55
    dia_frac: 0.8
    map_weighted_centering: true
    quality_rules:
      reject_if_low_snr: true
      reject_if_few_peaks: true
